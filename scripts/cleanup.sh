#!/bin/bash

echo "ЁЯз╣ ц╕ЕчРЖцоЛчХЩш┐ЫчиЛхТМчлпхПг..."

# цЭАцн╗хПпшГ╜чЪД Electron ш┐ЫчиЛ
echo "цнгхЬицЯецЙ╛ Electron ш┐ЫчиЛ..."
pkill -f "electron" 2>/dev/null || echo "ц▓бцЬЙцЙ╛хИ░ Electron ш┐ЫчиЛ"

# цЭАцн╗хПпшГ╜хНачФичлпхПгчЪДш┐ЫчиЛ
echo "цнгхЬицгАцЯечлпхПгхНачФицГЕхЖ╡..."

# цгАцЯех╣╢цЭАцн╗хНачФи 3001 члпхПгчЪДш┐ЫчиЛ
PORT_3001=$(lsof -ti:3001 2>/dev/null)
if [ ! -z "$PORT_3001" ]; then
    echo "хПСчО░члпхПг 3001 швлш┐ЫчиЛ $PORT_3001 хНачФия╝МцнгхЬич╗Ицнв..."
    kill -9 $PORT_3001 2>/dev/null || echo "цЧац│Хч╗Ицнвш┐ЫчиЛ $PORT_3001"
else
    echo "члпхПг 3001 цЬкшвлхНачФи"
fi

# цгАцЯех╣╢цЭАцн╗хНачФи 3002 члпхПгчЪДш┐ЫчиЛ
PORT_3002=$(lsof -ti:3002 2>/dev/null)
if [ ! -z "$PORT_3002" ]; then
    echo "хПСчО░члпхПг 3002 швлш┐ЫчиЛ $PORT_3002 хНачФия╝МцнгхЬич╗Ицнв..."
    kill -9 $PORT_3002 2>/dev/null || echo "цЧац│Хч╗Ицнвш┐ЫчиЛ $PORT_3002"
else
    echo "члпхПг 3002 цЬкшвлхНачФи"
fi

# цгАцЯех╣╢цЭАцн╗хНачФи 5173 члпхПгчЪДш┐ЫчиЛ (Vite dev server)
PORT_5173=$(lsof -ti:5173 2>/dev/null)
if [ ! -z "$PORT_5173" ]; then
    echo "хПСчО░члпхПг 5173 швлш┐ЫчиЛ $PORT_5173 хНачФия╝МцнгхЬич╗Ицнв..."
    kill -9 $PORT_5173 2>/dev/null || echo "цЧац│Хч╗Ицнвш┐ЫчиЛ $PORT_5173"
else
    echo "члпхПг 5173 цЬкшвлхНачФи"
fi

# цгАцЯех╣╢цЭАцн╗хНачФи 5174 члпхПгчЪДш┐ЫчиЛ (Vite dev server)
PORT_5174=$(lsof -ti:5174 2>/dev/null)
if [ ! -z "$PORT_5174" ]; then
    echo "хПСчО░члпхПг 5174 швлш┐ЫчиЛ $PORT_5174 хНачФия╝МцнгхЬич╗Ицнв..."
    kill -9 $PORT_5174 2>/dev/null || echo "цЧац│Хч╗Ицнвш┐ЫчиЛ $PORT_5174"
else
    echo "члпхПг 5174 цЬкшвлхНачФи"
fi

# цгАцЯех╣╢цЭАцн╗хНачФи 5858 члпхПгчЪДш┐ЫчиЛ (Electron debugger)
PORT_5858=$(lsof -ti:5858 2>/dev/null)
if [ ! -z "$PORT_5858" ]; then
    echo "хПСчО░члпхПг 5858 швлш┐ЫчиЛ $PORT_5858 хНачФия╝МцнгхЬич╗Ицнв..."
    kill -9 $PORT_5858 2>/dev/null || echo "цЧац│Хч╗Ицнвш┐ЫчиЛ $PORT_5858"
else
    echo "члпхПг 5858 цЬкшвлхНачФи"
fi

# цгАцЯех╣╢цЭАцн╗хНачФи 9222 члпхПгчЪДш┐ЫчиЛ (DevTools)
PORT_9222=$(lsof -ti:9222 2>/dev/null)
if [ ! -z "$PORT_9222" ]; then
    echo "хПСчО░члпхПг 9222 швлш┐ЫчиЛ $PORT_9222 хНачФия╝МцнгхЬич╗Ицнв..."
    kill -9 $PORT_9222 2>/dev/null || echo "цЧац│Хч╗Ицнвш┐ЫчиЛ $PORT_9222"
else
    echo "члпхПг 9222 цЬкшвлхНачФи"
fi

# ц╕ЕчРЖхПпшГ╜чЪДф╕┤цЧ╢цЦЗф╗╢
echo "ц╕ЕчРЖф╕┤цЧ╢цЦЗф╗╢..."
rm -rf dist-electron 2>/dev/null || echo "ц▓бцЬЙцЙ╛хИ░ dist-electron чЫох╜Х"

echo "тЬЕ ц╕ЕчРЖхоМцИРя╝БчО░хЬихПпф╗ещЗНцЦ░хРпхКих║ФчФиф║ЖуАВ"
echo ""
echo "ф╜┐чФиф╗еф╕ЛхС╜ф╗дхРпхКих║ФчФия╝Ъ"
echo "yarn dev"
